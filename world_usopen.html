<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    <link rel='stylesheet' href='css/mapstyle.css'>
    
    <script src='js/d3.v3.min.js' type='text/javascript'></script>
    <script src='js/topojson.v1.min.js' type='text/javascript'></script>
    <script src='js/colorbrewer.js' type='text/javascript'></script>
    <script src='js/cartogram.mod.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 800px;
      height: 400px;
    }  
    </style>
    
  </head>
  <body >
    
    
      <div id = 'chart2f0073887e30' class = 'carto' style='height:100%;width:100%;'>
      <div id='map-container'>
      <!--img id='placeholder' alt='placeholder image for old browsers' src='placeholder.png'-->
      <svg id = 'map' style = 'height:100%; width:100%' viewbox = '0 0 800 400'>
      </svg>
      </div>
      </div>    
    <script>
  var opts = {
 "dom": "chart2f0073887e30",
"width":    800,
"height":    400,
"map": "worldcountries.topojson",
"data": {
 "NAME": [ "-99", "AE", "AF", "AG", "AL", "AM", "AO", "AQ", "AR", "AT", "AU", "AZ", "BA", "BB", "BD", "BE", "BF", "BG", "BH", "BI", "BJ", "BN", "BO", "BR", "BS", "BT", "BW", "BY", "BZ", "CA", "CD", "CF", "CG", "CH", "CI", "CK", "CL", "CM", "CN", "CO", "CR", "CU", "CV", "CW", "CY", "CZ", "DE", "DJ", "DK", "DM", "DO", "DZ", "EC", "EE", "EG", "EH", "ER", "ES", "ET", "FI", "FJ", "FK", "FM", "FR", "GA", "GB", "GE", "GF", "GH", "GL", "GM", "GN", "GP", "GQ", "GR", "GT", "GU", "GW", "GY", "HK", "HN", "HR", "HT", "HU", "ID", "IE", "IL", "IM", "IN", "IQ", "IR", "IS", "IT", "JM", "JO", "JP", "KE", "KG", "KH", "KI", "KM", "KP", "KR", "KW", "KZ", "LA", "LB", "LC", "LK", "LR", "LS", "LT", "LU", "LV", "LY", "MA", "MD", "ME", "MG", "MH", "MK", "ML", "MM", "MN", "MP", "MR", "MT", "MU", "MV", "MW", "MX", "MY", "MZ", "NA", "NC", "NE", "NF", "NG", "NI", "NL", "NO", "NP", "NR", "NU", "NZ", "OM", "PA", "PE", "PF", "PG", "PH", "PK", "PL", "PR", "PS", "PT", "PW", "PY", "QA", "RE", "RO", "RS", "RU", "RW", "SA", "SB", "SC", "SD", "SE", "SG", "SI", "SK", "SL", "SN", "SO", "SR", "SS", "ST", "SV", "SY", "SZ", "TC", "TD", "TF", "TG", "TH", "TJ", "TK", "TL", "TM", "TN", "TO", "TR", "TT", "TV", "TW", "TZ", "UA", "UG", "US", "UY", "UZ", "VA", "VC", "VE", "VI", "VN", "VU", "WF", "WS", "XK", "YE", "YT", "ZA", "ZM", "ZW" ],
"NRLANGUAGES2010": [ 0, 1, 30, 1, 1, 3, 23, 0, 15, 2, 268, 8, 1, 1, 14, 4, 52, 2, 1, 1, 40, 5, 37, 201, 2, 20, 16, 1, 2, 76, 183, 56, 38, 6, 66, 4, 9, 242, 187, 82, 6, 2, 1, 1, 1, 4, 18, 0, 4, 1, 1, 13, 18, 2, 6, 0, 5, 14, 80, 7, 8, 0, 17, 18, 27, 13, 8, 3, 64, 1, 1, 27, 1, 9, 10, 51, 1, 12, 8, 1, 5, 5, 2, 2, 719, 3, 22, 1, 368, 12, 56, 2, 19, 2, 2, 14, 47, 2, 14, 1, 4, 0, 2, 0, 1, 50, 0, 1, 5, 25, 1, 3, 1, 3, 6, 7, 2, 0, 11, 1, 1, 32, 85, 4, 2, 3, 2, 1, 1, 8, 287, 110, 30, 16, 36, 10, 1, 486, 8, 12, 6, 105, 2, 1, 2, 7, 7, 100, 7, 826, 169, 57, 6, 1, 2, 3, 3, 15, 0, 1, 3, 5, 91, 1, 4, 71, 1, 63, 11, 2, 1, 2, 12, 25, 8, 11, 53, 3, 3, 3, 1, 1, 110, 0, 19, 33, 5, 1, 17, 2, 4, 3, 11, 2, 1, 22, 110, 5, 34, 210, 1, 5, 2, 1, 27, 2, 79, 108, 2, 1, 1, 6, 1, 19, 26, 7 ],
"FULLNAME": [ "Null", "United Arab Emirates", "Afghanistan", "Antigua and Barbuda", "Albania", "Armenia", "Angola", "Antarctica", "Argentina", "Austria", "Australia", "Azerbaijan", "Bosnia and Herzegovina", "Barbados", "Bangladesh", "Belgium", "Burkina Faso", "Bulgaria", "Bahrain", "Burundi", "Benin", "Brunei", "Bolivia", "Brazil", "Bahamas", "Bhutan", "Botswana", "Belarus", "Belize", "Canada", "Democratic Republic of the Congo", "Central African Republic", "Republic of the Congo", "Switzerland", "Ivory Coast", "Cook Islands", "Chile", "Cameroon", "China", "Colombia", "Costa Rica", "Cuba", "Cape Verde", "Curacao", "Cyprus", "Czechia", "Germany", "Djibouti", "Denmark", "Dominica", "Dominican Republic", "Algeria", "Ecuador", "Estonia", "Egypt", "Western Sahara", "Eritrea", "Spain", "Ethiopia", "Finland", "Fiji", "Falkland Islands", "Micronesia", "France", "Gabon", "United Kingdom", "Georgia", "French Guiana", "Ghana", "Greenland", "Gambia", "Guinea", "Guadeloupe", "Equatorial Guinea", "Greece", "Guatemala", "Guam", "Guinea-Bissau", "Guyana", "Hong Kong", "Honduras", "Croatia", "Haiti", "Hungary", "Indonesia", "Ireland", "Israel", "Isle of Man", "India", "Iraq", "Iran", "Iceland", "Italy", "Jamaica", "Jordan", "Japan", "Kenya", "Kyrgyzstan", "Cambodia", "Kiribati", "Comoros", "North Korea", "South Korea", "Kuwait", "Kazakhstan", "Laos", "Lebanon", "Saint Lucia", "Sri Lanka", "Liberia", "Lesotho", "Lithuania", "Luxembourg", "Latvia", "Libya", "Morocco", "Moldova", "Montenegro", "Madagascar", "Marshall Islands", "Macedonia", "Mali", "Myanmar [Burma]", "Mongolia", "Northern Mariana Islands", "Mauritania", "Malta", "Mauritius", "Maldives", "Malawi", "Mexico", "Malaysia", "Mozambique", "Namibia", "New Caledonia", "Niger", "Norfolk Island", "Nigeria", "Nicaragua", "Netherlands", "Norway", "Nepal", "Nauru", "Niue", "New Zealand", "Oman", "Panama", "Peru", "French Polynesia", "Papua New Guinea", "Philippines", "Pakistan", "Poland", "Puerto Rico", "Palestine", "Portugal", "Palau", "Paraguay", "Qatar", "Réunion", "Romania", "Serbia", "Russia", "Rwanda", "Saudi Arabia", "Solomon Islands", "Seychelles", "Sudan", "Sweden", "Singapore", "Slovenia", "Slovakia", "Sierra Leone", "Senegal", "Somalia", "Suriname", "South Sudan", "São Tomé and Príncipe", "El Salvador", "Syria", "Swaziland", "Turks and Caicos Islands", "Chad", "French Southern Territories", "Togo", "Thailand", "Tajikistan", "Tokelau", "East Timor", "Turkmenistan", "Tunisia", "Tonga", "Turkey", "Trinidad and Tobago", "Tuvalu", "Taiwan", "Tanzania", "Ukraine", "Uganda", "United States", "Uruguay", "Uzbekistan", "Vatican City", "Saint Vincent and the Grenadines", "Venezuela", "U.S. Virgin Islands", "Vietnam", "Vanuatu", "Wallis and Futuna", "Samoa", "Kosovo", "Yemen", "Mayotte", "South Africa", "Zambia", "Zimbabwe" ],
"POPULATION2010": [ 0, 8442, 28398, 87, 3150, 2963, 19549, 0, 40374, 8402, 22404, 9095, 3846, 280, 151125, 10941, 15540, 7389, 1252, 9233, 9510, 401, 10157, 195210, 360, 717, 1969, 9491, 309, 34126, 62191, 4350, 4112, 7831, 18977, 20, 17151, 20624, 1359821, 46445, 4670, 11282, 488, 148, 1104, 10554, 83017, 834, 5551, 71, 10017, 37063, 15001, 1299, 78076, 515, 5741, 46182, 87095, 5368, 861, 3, 104, 63231, 1556, 62066, 4389, 231, 24263, 57, 1681, 10876, 459, 696, 11110, 14342, 159, 1587, 786, 7050, 7621, 4338, 9896, 10015, 240676, 4468, 7420, 84, 1205625, 30962, 74462, 318, 60509, 2741, 6455, 127353, 40909, 5334, 14365, 98, 683, 24501, 48454, 2992, 15921, 6396, 4341, 177, 20759, 3958, 2009, 3068, 508, 2091, 6041, 31642, 3573, 620, 21080, 52, 2102, 13986, 51931, 2713, 54, 3609, 425, 1231, 326, 15014, 117886, 28276, 23967, 2179, 246, 15894, 0, 159708, 5822, 16615, 4891, 26846, 10, 1, 4368, 2803, 3678, 29263, 268, 6859, 93444, 173149, 38199, 3710, 4013, 10590, 20, 6460, 1750, 845, 21861, 9647, 143618, 10837, 27258, 526, 91, 35652, 9382, 5079, 2054, 5433, 5752, 12951, 9636, 525, 9941, 178, 6218, 21533, 1193, 31, 11721, 0, 6306, 66402, 7627, 1, 1079, 5042, 10632, 104, 72138, 1328, 10, 23146, 44973, 46050, 33987, 312247, 3372, 27769, 1, 109, 29043, 106, 89047, 236, 14, 186, 0, 22763, 204, 51452, 13217, 13077 ],
"country": [ null, null, null, null, null, null, null, null, "ARG", "AUT", "AUS", null, "BIH", null, null, "BEL", null, "BUL", null, null, null, null, null, "BRA", null, null, null, null, null, "CAN", null, null, null, "SUI", null, null, null, null, null, "COL", null, null, null, null, "CYP", "CZE", "GER", null, null, null, "DOM", null, null, null, null, null, null, "ESP", null, "FIN", null, null, null, "FRA", null, "GBR", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "CRO", null, null, null, "IRL", "ISR", null, null, null, null, null, "ITA", null, null, "JPN", null, null, null, null, null, null, null, null, "KAZ", null, null, null, null, null, null, null, "LUX", "LAT", null, null, "MDA", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "NED", null, null, null, null, null, null, null, null, null, null, null, null, "POL", null, null, "POR", null, null, null, null, null, "SRB", "RUS", null, null, null, null, null, null, null, "SLO", "SVK", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "TPE", null, "UKR", null, "USA", "URU", "UZB", null, null, null, null, null, null, null, null, null, null, null, "RSA", null, null ],
"gameswon": [ null, null, null, null, null, null, null, null,    141,    104,    161, null,     11, null, null,     84, null,     71, null, null, null, null, null,     38, null, null, null, null, null,    140, null, null, null,    195, null, null, null, null, null,     65, null, null, null, null,      4,    107,    219, null, null, null,     61, null, null, null, null, null, null,    491, null,     18, null, null, null,    524, null,    101, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,    184, null, null, null,     15,     25, null, null, null, null, null,    130, null, null,    160, null, null, null, null, null, null, null, null,     67, null, null, null, null, null, null, null,     26,     40, null, null,      9, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,     35, null, null, null, null, null, null, null, null, null, null, null, null,     38, null, null,     33, null, null, null, null, null,    135,    208, null, null, null, null, null, null, null,     62,     53, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,      8, null,     45, null,    250,     24,     15, null, null, null, null, null, null, null, null, null, null, null,     69, null, null ] 
},
"id": "chart2f0073887e30" 
};
  
  //copied mostly from https://gist.github.com/mbostock/8fadc5ac9c2a9e7c5ba2
  
  //drawCartogram = (function(){
    var colors = colorbrewer.RdYlBu[3]
            //.reverse()
            .map(function(rgb) { return d3.hsl(rgb); });


    var width = opts.width,
      height = opts.height;
    
    var proj = (opts.projection) ? opts.projection : d3.geo.mercator();
    
    
    /*proj
        .translate([width / 2, height / 2])
        .scale((width - 1) / 2 / Math.PI);
    */
    var zoom = d3.behavior.zoom()
      .translate([0,0])
      .scale(.7)
      //.scaleExtent([0.5, 10.0])
      .on("zoom", updateZoom)
  
    
    var path = d3.geo.path()
      .projection(proj);
    
    var map = d3.select("#map")
    
    var svg = d3.select( chart2f0073887e30 ).select("svg")
      .attr("id","map")
      .append("g");
     
  
    updateZoom();
    

    function updateZoom() {
      var scale = zoom.scale();
      svg.attr("transform",
        "translate(" + zoom.translate() + ") " +
        "scale(" + [scale, scale] + ")");
    }

    worldcountries = svg.append("g")
        .attr("id", "worldcountries")
        .selectAll("path");

    // set this data up as global so we can access later and test
    var data = {};

    // we will need to change opts data to proper format
    // where we will nest by country id/name
    opts.data[Object.keys(opts.data)[0]].forEach( function(d,i) {
      
      data[ d ] = {};
      
      Object.keys( opts.data ).map( function(k) {
        data[d][k] = opts.data[k][i];
      })
    })
    
    var carto = d3.cartogram()
        .projection(proj)
        .properties( function(d) {
          return data[d.id];
        })
        .value( function(d) {
          return (typeof d.properties[ opts.x ] == "undefined" ) ? 0 : +d.properties[ opts.x ];
        });
     
    d3.json( opts.map , function(error, world) {
      var features = carto.features(world, world.objects.worldcountries).features;
      
      var value = function(d) {
            return (typeof d.properties[ opts.x ] == "undefined" ) ? 0 : +d.properties[ opts.x ];
          },
          values = features
            .map(value)
            .filter(function(n) {
              return !isNaN(n);
            })
            .sort(d3.ascending),
          lo = values[0],
          hi = values[values.length - 1];

      var color = d3.scale.linear()
        .range(colors)
        .domain(lo < 0
          ? [lo, 0, hi]
          : [lo, d3.mean(values), hi]);

      // normalize the scale to positive numbers
      var scale = d3.scale.linear()
        .domain([lo, hi])
        .range([10, 1000]);
        
      worldcountries = worldcountries.data( features )
          .enter()
          .append("path")
            .attr("class", "country")
            .attr("id", function(d) {
            //console.log(d)
              return d.properties.NAME;
              //return d.objects.worldcountries.geometries.id;
            })
            .attr("fill", "#fafafa")
            .attr("cursor","pointer")
            .attr("fill", function(d) {
              return color(value(d));
            })
            .attr("d", path);        
        
      // tell the cartogram to use the scaled values
      carto.value(function(d) {
        return scale(value(d));
      });
      
      // generate the new features, pre-projected
      var features = carto(world, world.objects.worldcountries.geometries).features;
    
          
      worldcountries = worldcountries.data( features )            
      worldcountries.transition()
          .duration(2750)
          .ease("linear")
          .attr("d", carto.path);            

    });
    

    
    function zoomed() {
      var scale = zoom.scale();
      layer.attr("transform",
        "translate(" + zoom.translate() + ") " +
        "scale(" + [scale, scale] + ")");
    }
    
  //})();
  
</script>
    
    <script></script>    
  </body>
</html>
